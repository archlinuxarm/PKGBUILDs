# Maintainer: Manuel Rotter <rotter.manuel@gmail.com>

pkgname=glibc-native
pkgver=2.11
pkgrel=1
pkgdesc="GNU C Library - for native programs in crossdev environment"
arch=('i686' 'x86_64')
license=('GPL' 'LGPL')
url="http://www.gnu.org/software/libc"
depends=('kernel-headers>=2.6.29')
makedepends=("glibc==$pkgver")

_LIBDIR=/usr/lib/$CARCH

build() {
  mkdir -p $pkgdir$_LIBDIR

  pacman -Ql glibc | grep -o '\(/usr\)\?/lib/.\+' | while read fn; do
    if [ "${fn: -1}" == '/' ]; then
      test "${fn: -1}" == '/' && mkdir -p "$pkgdir$_LIBDIR/${fn#*/lib/}"
    else
      cp -d --preserve=all $fn "$pkgdir$_LIBDIR${fn#*/lib}"
    fi
  done

  # Create our arch independent linker as symlink.
  ln -s $_LIBDIR/ld-${pkgver}.so "$pkgdir$_LIBDIR/ld-linux.so.2"
}
