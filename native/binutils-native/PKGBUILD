# Maintainer: Manuel Rotter <manuel.rotter@gmail.com>

pkgname=binutils-native
_pkgname=binutils
pkgver=2.20.1
_date=20100521
pkgrel=1
pkgdesc="binutils for cross-compiling to arm-softfloat-linux-gnueabi"
arch=('i686' 'x86_64')
group=(arm-crossdev)
url="http://www.gnu.org/software/binutils/"
license=('GPL')
options=('!libtool' '!docs' '!emptydirs')
depends=('zlib-native' 'glibc-native>=2.9')
source=(ftp://ftp.archlinux.org/other/${_pkgname}/${_pkgname}-${pkgver}_${_date}.tar.bz2)
md5sums=('67053ffd8582e646e171fccd55b2f0f6')

_PREFIX=/usr/arm-softfloat-linux-gnueabi
_LIBDIR=/usr/lib/$CARCH
_LINKER=$_LIBDIR/ld-linux.so.2

build() {
  mkdir "${srcdir}/binutils-build"
  cd "${srcdir}/binutils-build"

  ../configure --prefix=$_PREFIX \
       --target=arm-softfloat-linux-gnueabi \
       --with-sysroot=$_PREFIX/sysroot || return 1
  make LDFLAGS="-Wl,-dynamic-linker,$_LINKER" || return 1
  make DESTDIR=$pkgdir install || return 1

  # Link to defaults names.
  cd $pkgdir$_PREFIX/bin
  for i in *; do
    ln -s $i ${i/arm-softfloat-linux-gnueabi-/}
  done

  # Remove man and info pages.
  for dir in man info; do
    rm -rf $pkgdir$_PREFIX/$dir
  done
}
