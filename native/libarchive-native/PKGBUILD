# Maintainer: Manuel Rotter <rotter.manuel@gmail.com> 

pkgname=libarchive-native
_pkgname=libarchive
pkgver=2.7.0
pkgrel=1
pkgdesc="library that can create and read several streaming archive formats"
arch=(i686 x86_64)
url="http://libarchive.googlecode.com/"
license=('BSD')
groups=('crossdev')
depends=('zlib-native' 'bzip2-native' 'xz-utils-native' 'acl-native' 'openssl-native')
source=(http://libarchive.googlecode.com/files/libarchive-$pkgver.tar.gz)
md5sums=('a2103ca334037562ad327eb3aed54869')

# pacman.static build fails unless we keep the libtool files (or unless we link
# the missing symbols inside the libarchive .a static lib, but that is dirty)
options=(libtool)

_PREFIX=/usr/arm-softfloat-linux-gnueabi
_LIBDIR=/usr/lib/$CARCH
_LINKER=$_LIBDIR/ld-linux.so.2

build() {
  cd $startdir/src/$_pkgname-$pkgver
      ./configure  --prefix=$_PREFIX \
      --build=$CHOST \
      --host=$CHOST \
      --target=arm-softfloat-linux-gnueabi \
      --with-sysroot=$_PREFIX/sysroot
  make LDFLAGS="-Wl,-dynamic-linker,$_LINKER" || return 1
  make DESTDIR=$pkgdir install || return 1
  # install license
  mkdir -p $startdir/pkg/usr/arm-softfloat-linux-gnueabi/share/licenses/libarchive
  install -m644 COPYING $startdir/pkg/usr/arm-softfloat-linux-gnueabi/share/licenses/libarchive/
}
