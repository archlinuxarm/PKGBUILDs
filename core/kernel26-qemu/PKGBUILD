# Maintainer: Krzysztof "hiciu" Warzecha <kwarzecha7@gmail.com>
pkgname=kernel26-qemu
pkgver=2.6.30
pkgrel=4
_patchname="patch-${pkgver}-${pkgrel}-ARCH"
groups=() #see #96
pkgdesc="The Linux Kernel (without modules support) - for qemu-system-arm / ARM Integrator/CP"
arch=('arm')
license=('GPL2')
url="http://kernel.org/"
depends=('coreutils')
source=(ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-${pkgver}.tar.bz2
        ftp://ftp.archlinux.org/other/kernel26/${_patchname}.bz2
		config)
md5sums=('7a80058a6382e5108cdb5554d1609615'
         '8a9575026bf6c8f8117a4832e0031d84'
         '3b4b0ba57d7634d6678110afb58dc71a')

build() {
  cd ${srcdir}/linux-${pkgver}
  # Add -ARCH patches
  patch -Np1 -i ${srcdir}/${_patchname} || return 1
  
  cat ../config > .config
  yes "" | make config  || return 1
  make prepare  #this can fail, I don't know why...
  make bzImage || return 1
  
  mkdir -p ${pkgdir}/boot/
  cp arch/arm/boot/zImage ${pkgdir}/boot/zImage-qemu
}
