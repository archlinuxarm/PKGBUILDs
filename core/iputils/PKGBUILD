# Maintainer: Alexander Foremny <alexanderforemny@gmail.com>
# Modified by OpenPogo

pkgname=iputils
pkgver=20071127
_traceroutever=1.4a12
pkgrel=3
pkgdesc="IP Configuration Utilities (and Ping)"
arch=(arm)
license=('GPL')
url="http://www.linuxfoundation.org/en/Net:Iputils"
depends=(glibc)
source=(http://www.skbuff.net/iputils/$pkgname-s$pkgver.tar.bz2
        ftp://ftp.ee.lbl.gov/traceroute-$_traceroutever.tar.gz
		iputils-20070202-no-open-max.patch
		permission-fix.patch)
md5sums=('12245e9927d60ff5cf4a99d265bcb7d3'
		 '964d599ef696efccdeebe7721cd4828d'
		 'a2cbc0174dd883f68297aa7f3e7c4f5c'
		 '66109966cad06e425bb12a78bab85b70')

build() {
  msg "Building ipuitls."
  cd "$srcdir/iputils-s$pkgver"

  patch -Np1 -i ../iputils-20070202-no-open-max.patch || return 1
  make KERNEL_INCLUDE=/opt/include || return 1
  for i in arping clockdiff rarpd rdisc tftpd tracepath tracepath6; do
    install -D -m755 $i $startdir/pkg/opt/sbin/$i
  done
  for i in ping ping6 traceroute6; do
    install -D -m4755 $i $startdir/pkg/opt/bin/$i
  done

  msg "Building traceroute."
  cd "$srcdir/traceroute-$_traceroutever"

  patch -Np1 -i ../permission-fix.patch || return 1
  ./configure --prefix=/opt --sbindir=/opt/bin
  make CFLAGS="${CFLAGS} -Ilinux-include/" || return 1
  make DESTDIR=${startdir}/pkg install
}
