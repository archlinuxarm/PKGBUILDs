# Maintainer: Alexander Foremny <alexanderforemny@gmail.com>

pkgname=iputils
pkgver=20071127
_traceroutever=1.4a12
pkgrel=3
pkgdesc="IP Configuration Utilities (and Ping)"
arch=(arm)
groups=(base)
license=('GPL')
url="http://www.linuxfoundation.org/en/Net:Iputils"
depends=(glibc)
source=(http://www.skbuff.net/iputils/$pkgname-s$pkgver.tar.bz2
        ftp://ftp.ee.lbl.gov/traceroute-$_traceroutever.tar.gz
	iputils-20070202-no-open-max.patch permission-fix.patch)

build() {
  msg "Building ipuitls."
  cd "$srcdir/iputils-s$pkgver"

  patch -Np1 -i ../iputils-20070202-no-open-max.patch || return 1
  make KERNEL_INCLUDE=/usr/include || return 1
  for i in arping clockdiff rarpd rdisc tftpd tracepath tracepath6; do
    install -D -m755 $i $startdir/pkg/usr/sbin/$i
  done
  for i in ping ping6 traceroute6; do
    install -D -m4755 $i $startdir/pkg/bin/$i
  done

  msg "Building traceroute."
  cd "$srcdir/traceroute-$_traceroutever"

  patch -Np1 -i ../permission-fix.patch || return 1
  ./configure --prefix=/usr --sbindir=/bin
  make CFLAGS="${CFLAGS} -Ilinux-include/" || return 1
  make DESTDIR=${startdir}/pkg install
}
