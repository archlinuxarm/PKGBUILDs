# Amlogic Mali GL Driver
# Maintainer: Oleg Ivanov <balbes-150@yandex.ru>

buildarch=8

pkgbase=libgl-aml
pkgname=("${pkgbase}-fb" "${pkgbase}-headers")
pkgver=r5p1
pkgrel=1
_commit=228b2e75bea3426661437d5642fbae3a376895fd
arch=('aarch64')
url="http://www.hardkernel.com/"
license=('Proprietary')
depends=('mesa-libgl')
makedepends=('git')
source=("git+https://github.com/mdrjr/c2_mali.git#commit=${_commit}"
        'mali.conf'
        '99-mali.rules')
md5sums=('SKIP'
         '40f5104200cfceb12b4623d219646d4e'
         '88e938d52d0e02657fa5eca2efc6ee36')

#package_aml-libgl-x11() {
#  pkgdesc="Amlogic Mali driver (X11)"
#  conflicts=('odroid-c2-libgl')
#  provides=('odroid-c2-libgl')

#  install -d "${pkgdir}"/usr/lib/mali-egl
#  install -d "${pkgdir}"/etc/ld.so.conf.d
#  cp -a c2_mali/x11/mali_libs/lib* "${pkgdir}"/usr/lib/mali-egl
#  cp "${srcdir}"/mali.conf "${pkgdir}"/etc/ld.so.conf.d
#}

package_libgl-aml-fb() {
  pkgdesc="Amlogic Mali driver (framebuffer)"
  conflicts=('odroid-c2-libgl')
  provides=('odroid-c2-libgl')

  install -d "${pkgdir}"/usr/lib/mali-egl
  install -d "${pkgdir}"/etc/ld.so.conf.d
  install -d "${pkgdir}"/usr/lib/udev/rules.d
  cp -a c2_mali/fbdev/mali_libs/lib* "${pkgdir}"/usr/lib/mali-egl
  cp "${srcdir}"/mali.conf "${pkgdir}"/etc/ld.so.conf.d
  cp "${srcdir}"/99-mali.rules "${pkgdir}"/usr/lib/udev/rules.d
}

package_libgl-aml-headers() {
  pkgdesc="Amlogic Mali driver headers"

  install -d "${pkgdir}"/usr/include
  cp -a c2_mali/fbdev/mali_headers/{EGL,GLES,GLES2,KHR} "${pkgdir}"/usr/include
}
