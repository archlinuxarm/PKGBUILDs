# Contributor: Jaroslaw Swierczynski <swiergot@juvepoland.com>

pkgname=em8300
pkgver=0.16.4
_kernver=2.6.24-ARCH
pkgrel=1
pkgdesc="DXR3 and Hollywood+ driver"
arch=('i686' 'x86_64')
url="http://dxr3.sourceforge.net/"
license=('GPL2')
depends=(kernel26 em8300-utils)
conflicts=(em8300-cvs)
replaces=(em8300-cvs)
install=em8300.install
#source=(http://dl.sourceforge.net/sourceforge/dxr3/$pkgname-$pkgver.tar.gz \
source=(http://dxr3.sourceforge.net/download/em8300-$pkgver-rc1.tar.gz)
md5sums=('7abc675b66dcc6e1c5b273b8e94958fd')

build() {
  cd $startdir/src/$pkgname-$pkgver-rc1/modules

  sed -i "s!^KERNEL_LOCATION := .*\$!KERNEL_LOCATION := /lib/modules/${_kernver}/build!" Makefile

  make || return 1
  make DESTDIR=$startdir/pkg install || return 1

  chmod 644 $startdir/pkg/lib/modules/*/em8300/*.ko
  sed -i -e "s/KERNEL_VERSION='.*'/KERNEL_VERSION='${_kernver}'/" $startdir/*.install
}
