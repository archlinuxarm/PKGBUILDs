# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Douglas Soares de Andrade <dsandrade@gmail.com>
# Contributor: Vinay S Shastry <vinayshastry@gmail.com>

pkgname=mysql-gui-tools
pkgver=5.0r14
pkgrel=3
arch=('i686' 'x86_64')
pkgdesc="Set of programs to manage and interact with a MySQL server."
url="http://www.mysql.com/products/tools/"
license=('GPL')
source=(http://mirrors.uol.com.br/pub/mysql/Downloads/MySQLGUITools/$pkgname-$pkgver.tar.gz
        bad-char.patch
        mysql-gui-tools-sigc_2.1.1_api_fixes.diff
        mysql-gui-tools-5.0_p12-deprecated-gtk+-api.patch
        mysql-gui-tools-gcc43.patch
        mysql-gui-tools-schema-change-freeze.patch)
depends=('gtkmm' 'gtkhtml' 'libmysqlclient' 'pcre')
replaces=('mysql-administrator' 'mysql-query-browser')
conflicts=('mysql-administrator' 'mysql-query-browser')
provides=('mysql-gui-common' 'mysql-administrator' 'mysql-query-browser')
makedepends=('pkgconfig' 'lua' 'libxml2' 'libgnomeprint')
options=('!makeflags')

build() {
    cd $startdir/src/$pkgname-$pkgver

    # Patch to make 5.0r14 compile
    patch -Np1 < $startdir/src/bad-char.patch
    patch -Np1 < $startdir/src/mysql-gui-tools-sigc_2.1.1_api_fixes.diff
    patch -Np1 < $startdir/src/mysql-gui-tools-gcc43.patch
    patch -Np0 < $startdir/src/mysql-gui-tools-5.0_p12-deprecated-gtk+-api.patch
    patch -Np0 < $startdir/src/mysql-gui-tools-schema-change-freeze.patch

    cd $startdir/src/$pkgname-$pkgver/common

    sh autogen.sh
	./configure --prefix=/usr --datarootdir=/usr/share --with-gtkhtml=libgtkhtml-3.14 || return 1
  	
  	make || return 1
  	make DESTDIR=$startdir/pkg install || return 1

    cd ..
    cp -R common mysql-gui-common

  	cd $startdir/src/$pkgname-$pkgver/administrator
    sh autogen.sh
  	./configure --prefix=/usr --datarootdir=/usr/share --with-gtkhtml=libgtkhtml-3.14 || return 1
 	make || return 1
  	make DESTDIR=$startdir/pkg install || return 1

  	cd $startdir/src/$pkgname-$pkgver/query-browser
    sh autogen.sh
  	./configure --prefix=/usr --datarootdir=/usr/share --with-gtkhtml=libgtkhtml-3.14 || return 1

  	make CFLAGS="${CFLAGS} -D_GNU_SOURCE" || return 1
  	make DESTDIR=$startdir/pkg install || return 1

  	#cd $startdir/src/$pkgname-$pkgver/mysql-workbench

    #patch -p1 < ../../mysql-gui-tools-5.0_p12-workbench-lua.patch

  	#./configure --prefix=/usr --with-gtkhtml=libgtkhtml-3.14 || return 1
  	#make || return 1
  	#make DESTDIR=$startdir/pkg install

    # Some adjusts to make mysql-workbench run
    #cd $startdir/pkg/usr/bin
    #mv mysql-workbench mysql-wb
    #mv mysql-workbench-bin mysql-wb-bin
    #install -m755 $startdir/src/mysql-workbench.sh mysql-workbench
    #rm -rf $startdir/pkg/usr/lib/

    # Fixed startup scripts
    install -m755 $startdir/mysql-administrator $pkgdir/usr/bin
    install -m755 $startdir/mysql-query-browser $pkgdir/usr/bin

}
md5sums=('b8efefbf20b7264c8f3afd34424467d7'
         '4279c75bb5e6c2bfcb16c98817d55b80'
         '4625629385142862cd01d37f814d5e80'
         '33205d45329ab4fa4096b6b298a60b2c'
         '1368384dac87bc0a64adb774ab2e6cbd'
         'd2f5a0405cbf7430bffb4c5c83ae5b34')
