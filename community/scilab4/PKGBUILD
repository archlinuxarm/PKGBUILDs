# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: JJDaNiMoTh <jjdanimoth@gmail.com>

pkgname=scilab4
pkgver=4.1.2
pkgrel=2
pkgdesc="Scilab is a scientific software package for numerical computations"
arch=('i686' 'x86_64')
url="http://www.scilab.org/"
license=('custom')
depends=('bash' 'tk' 'libgtkhtml' 'vte' 'gcc-libs' 'libxml2')
makedepends=('libxt')
conflicts=('scilab')
provides=('scilab=$pkgver')
source=(http://www.scilab.org/download/$pkgver/scilab-$pkgver-src.tar.gz \
  http://www.scilab.org/download/4.1.2/man-eng-scilab-$pkgver.tar.gz \
  http://www.scilab.org/download/4.1.2/man-fr-scilab-$pkgver.tar.gz \
  scilab.desktop)
md5sums=('17a7a6aa52918f33d96777a0dc423658' 'ad6286f324891fe8b86c60e4012a36b7')

build() {
  cd $startdir/src/scilab-$pkgver
  export MAKEFLAGS="-j1"
  [ "$CARCH" = "x86_64" ] && sed -i "s/CC_PLAT_OPTIONS='-march=athlon64 -mfpmath=sse -msse2 -m3dnow -m64'/CC_PLAT_OPTIONS='-march=x86-64 -mtune=generic -pipe'/" configure
  ./configure --prefix=/usr --with-gfortran --with-tk --with-pvm --without-ocaml --without-java --with-gtk2
  make all || return 1
  make PREFIX=$startdir/pkg/usr install
  install -D -m644 X11_defaults/scilab.xpm $startdir/pkg/usr/share/icons/scilab4.xpm
  install -D -m644 license.txt $startdir/pkg/usr/share/licenses/scilab4/license.txt
  install -D -m644 $startdir/src/scilab.desktop $startdir/pkg/usr/share/applications/scilab4.desktop

  sed -i -e "s=SCI\=\"$startdir/pkg/usr/lib/scilab-$pkgver\"=SCI\=\"/usr/lib/scilab-$pkgver\"=" $startdir/pkg/usr/lib/scilab-$pkgver/bin/scilab
  ln -fs /usr/lib/scilab-$pkgver/bin/scilab $startdir/pkg/usr/bin/scilab4
  ln -fs /usr/lib/scilab-$pkgver/bin/intersci $startdir/pkg/usr/bin/intersci
  ln -fs /usr/lib/scilab-$pkgver/bin/intersci-n $startdir/pkg/usr/bin/intersci-n
}
