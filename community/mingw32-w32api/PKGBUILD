# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Maintainer: Ondrej Jirman <megous@megous.com>

pkgname=mingw32-w32api
pkgver=3.13
_runtimever=3.15.2
pkgrel=1
arch=(i686 x86_64)
pkgdesc="Windows header files fro mingw32 C cross-compiler"
makedepends=(mingw32-gcc-base)
options=(!strip)
license=(LGPL)
url="http://www.mingw.org/"
source=(http://downloads.sourceforge.net/mingw/w32api-$pkgver-mingw32-src.tar.gz \
        http://downloads.sourceforge.net/mingw/mingwrt-${_runtimever}-mingw32-src.tar.gz)
md5sums=('8eae788a09a589414b83adc91bb0c069'
         '7bf0525f158213f3ac990ea68a5ec34d')

build()
{
  cd $startdir/src/w32api-$pkgver-mingw32

  mkdir -p $startdir/src/include/
  cp -r $startdir/src/mingwrt-${_runtimever}-mingw32/include/* \
    $startdir/src/include/

  export CFLAGS="-mms-bitfields -I$startdir/src/include -I$startdir/src/w32api-$pkgver-mingw32/include"

  ./configure \
    --prefix=/usr/i486-mingw32 \
    --target=i486-mingw32 \
    --host=i486-mingw32 \
    --build=$CHOST \
    || exit 1

  make || exit 1
  make install prefix=$startdir/pkg/usr/i486-mingw32 || exit 1

  cd $startdir/pkg
  find . -name '*.a' | xargs -rtl1 i486-mingw32-strip -g
}
