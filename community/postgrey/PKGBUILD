# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Sean Timothy Noonan <stnoonan@obsolescence.net>

pkgname=postgrey
pkgver=1.32
pkgrel=1
pkgdesc="a Postfix policy server implementing greylisting"
arch=('i686' 'x86_64')
url="http://postgrey.schweikert.ch/"
options=(emptydirs)
license=("GPL")
depends=('perl-net-server' 'perl>=5.6.0' 'perl-berkeleydb' 'perl-io-multiplex' 'db>=4.1' 'postfix')
backup=(etc/postfix/postgrey_whitelist_recipients
	etc/postfix/postgrey_whitelist_clients
	etc/conf.d/postgrey)
install=$pkgname.install
source=($url/pub/$pkgname-$pkgver.tar.gz
	postgrey.rc
	postgrey.rc.conf)
md5sums=('524a4e165bf997996f3bccade394712f'
         '607dacccfda43bc130ec704b01847ae8'
         'a7e15d38b28084c6e25e7818adc047a4')

build() {
  cd $srcdir/$pkgname-$pkgver
  chown -R root:root .
  mkdir -p $pkgdir/var/spool/postfix/postgrey
  install -D -m 0755 $srcdir/postgrey.rc $pkgdir/etc/rc.d/postgrey && \
  install -D -m 0644 $srcdir/postgrey.rc.conf $pkgdir/etc/conf.d/postgrey && \
  install -D -m 0755 postgrey $pkgdir/usr/sbin/postgrey && \
  install -D -m 0755 contrib/postgreyreport $pkgdir/usr/sbin/postgreyreport && \
  install -D -m 0644 postgrey_whitelist_recipients $pkgdir/etc/postfix/postgrey_whitelist_recipients && \
  install -D -m 0644 postgrey_whitelist_clients $pkgdir/etc/postfix/postgrey_whitelist_clients
}
