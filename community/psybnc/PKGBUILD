pkgname=psybnc
_pkgname=psyBNC
pkgver=2.3.2_9
# note: if the pkgver had been '0.99-10' then use an underscore, i.e. '0.99_10'
_pkgver=2.3.2-9
pkgrel=2
pkgdesc="psyBNC is an easy-to-use, multi-user, permanent IRC-Bouncer with many features."
arch=('i686' 'x86_64' 'arm')
url="http://www.psybnc.at"
license=('GPL')
depends=('openssl')
makedepends=('ncurses')
backup=('usr/bin/psybnc/psybnc.conf')
source=(http://psybnc.at/download/beta/$_pkgname-$_pkgver.tar.gz compile.diff psybnc-2.3.2.9-multinetwork.patch psybnc-2.3.2.9-oidentd.patch psybnc-2.3.2.9-scripting.patch)
install=(psybnc.install)
md5sums=('c2757cdf2cab668eb374a22abecc5572'
         '2124f394dd96767745c213070d934f54'
         '065671a27e298a64c89ee2b62aecf0da'
         '8666bbf5d677b3819bb930ed0ea63672'
         '12604c39d6b35a8065a0813fb79e8a1c')

build() {
  # Enter build directory
  cd $srcdir/$pkgname  || return 1

  patch -p0 < ../compile.diff || return 1
  patch -p0 < ../psybnc-2.3.2.9-multinetwork.patch || return 1
  patch -p0 < ../psybnc-2.3.2.9-oidentd.patch || return 1
  patch -p0 < ../psybnc-2.3.2.9-scripting.patch || return 1

  # Prevent stripping the binary
  sed -i -e "/@strip/ d" $srcdir/$pkgname/tools/autoconf.c || return 1

  # Pretend we already have a certificate, we generate it in pkg_config
  mkdir -p $srcdir/$pkgname/key || return 1
  touch $srcdir/$pkgname/key/psybnc.cert.pem || return 1

  make clean  || return 1
  make || return 1

  # Create package tree and extract distributable binary
  mkdir -p $pkgdir/usr/share || return 1
  cp -R $srcdir/$pkgname $pkgdir/usr/share || return 1

  # Remove distributable binary and return to source folder(necessary?)
  cd $srcdir/$pkgname || return 1
}
