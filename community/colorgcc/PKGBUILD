# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Eric Belanger <eric@archlinux.org>
# Contributor: pressh <pressh@gmail.com>

pkgname=colorgcc
pkgver=1.3.2
pkgrel=5
pkgdesc="A Perl wrapper to colorize the output of compilers with warning/error messages matching the gcc output format."
arch=('i686' 'x86_64')
url="http://www.schlueters.de/colorgcc.html"
license=('GPL')
depends=('perl')
backup=('etc/colorgcc/colorgccrc')
source=(http://distro.ibiblio.org/pub/linux/distributions/gentoo/distfiles/${pkgname}-${pkgver}.tar.gz colorgcc_1.3.2.0-8.diff)
md5sums=('7d62f92ab99c8271c79c40a0a470e8f7' 'c02b0c87d5b5f5b1a3b6d54e10f4b5b4')
sha1sums=('c2944ecaaa58f41f37cc15304f4f9eae0c366cd9'
          '646eda92f8b0d9f824b50b99983d306924c3b53c')

build() {
  cd ${srcdir}/${pkgname}-${pkgver}
  patch -p1 < ../colorgcc_1.3.2.0-8.diff || return 1
  patch -p1 < debian/patches/005_old_changes.dpatch || return 1
  patch -p1 < debian/patches/01_split_non_quoted.dpatch || return 1
  patch -p1 < debian/patches/02_stderr.dpatch || return 1
  patch -p1 < debian/patches/03_color_warnings.dpatch || return 1
  patch -p1 < debian/patches/04_g++_color.dpatch || return 1
  patch -p1 < debian/patches/05_console-colors.dpatch || return 1
  patch -p1 < debian/patches/06_use_distcc.dpatch || return 1
  patch -p1 < debian/patches/07_invalid_attr.dpatch || return 1
  patch -p1 < debian/patches/08_force_color_opt.dpatch || return 1
  patch -p1 < debian/patches/09_color_warnings.dpatch || return 1

  install -D -m644 colorgccrc ${pkgdir}/etc/colorgcc/colorgccrc || return 1
  install -D -m755 colorgcc ${pkgdir}/usr/bin/colorgcc || return 1
  install -D -m644 debian/colorgccrc.5 ${pkgdir}/usr/share/man/man5/colorgccrc.5 || return 1
  install -D -m644 debian/colorgcc.1 ${pkgdir}/usr/share/man/man1/colorgcc.1 || return 1

  install -d ${pkgdir}/bin
  ln -s /usr/bin/colorgcc ${pkgdir}/bin/gcc
  ln -s /usr/bin/colorgcc ${pkgdir}/bin/g++
  ln -s /usr/bin/colorgcc ${pkgdir}/bin/cc
  ln -s /usr/bin/colorgcc ${pkgdir}/bin/c++
  ln -s /usr/bin/colorgcc ${pkgdir}/bin/gcj
}
