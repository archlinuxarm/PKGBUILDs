# $Id: PKGBUILD 3200 2009-09-30 09:05:45Z spupykin $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: J. Santiago Hirschfeld <jsantiagoh@yahoo.com.ar>

_kernver=`pacman -Q kernel26 | cut -d . -f 3 | cut -f 1 -d -`
pkgname=cdfs
pkgver=2.6.27
pkgrel=5
pkgdesc="File system module that 'exports' all tracks and boot images on a CD as normal files."
arch=(i686 x86_64)
url="http://www.elis.UGent.be/~ronsse/cdfs/"
license=('GPL')
install=cdfs.install
depends=("kernel26>=2.6.${_kernver}" "kernel26<2.6.`expr ${_kernver} + 1`")
source=("http://www.elis.UGent.be/~ronsse/cdfs/download/$pkgname-$pkgver.tar.bz2")
md5sums=('84366b903d6beb6ddca5ab457bb8ec33')

build() {
  cd $startdir/src/$pkgname-$pkgver

  patch cddata.c <<EOF
85c85
<   .sendfile         = generic_file_sendfile
---
> //  .sendfile         = generic_file_sendfile
EOF

  make || return 1
  mkdir -p $startdir/pkg/lib/modules/`uname -r`/extra && \
  cp cdfs.ko $startdir/pkg/lib/modules/`uname -r`/extra
}
