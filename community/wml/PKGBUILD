# $Id: PKGBUILD 3059 2009-09-26 15:02:40Z ibiru $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=wml
pkgver=2.0.11
pkgrel=3
pkgdesc="The Website Meta Language"
arch=('i686' 'x86_64')
url="http://thewml.org/"
license=('GPL')
depends=('perl' 'libpng' 'gdbm' 'db>=4.8.24' 'ncurses')
makedepends=('lynx')
source=("http://thewml.org/distrib/$pkgname-$pkgver.tar.gz")
md5sums=('a26feebf4e59e9a6940f54c69dde05b5')
build() {
  cd $startdir/src/$pkgname-$pkgver

  unset LDFLAGS
  ./configure --prefix=/usr

  # compile fixhack
  sed -i 's#/usr/lib/perl5/core_perl/auto/DynaLoader/DynaLoader.a##' wml_backend/p3_eperl/Makefile
  sed -i 's/extern struct option options\[\]\;//' $startdir/src/$pkgname-$pkgver/wml_backend/p3_eperl/eperl_proto.h
  sed -i 's|strip $dsttmp|#strip $dsttmp|' etc/shtool
  mkdir -p $pkgdir/usr/bin $pkgdir/usr/lib/wml/exec $pkgdir/usr/man/man{1,3,7} $pkgdir/usr/man/cat{1,7}

#  make clean || return 1
  make || return 1
  make prefix=$startdir/pkg/usr install || return 1

  [ -d $pkgdir/usr/man ] && mkdir -p $pkgdir/usr/share && mv $pkgdir/usr/man $pkgdir/usr/share
}
