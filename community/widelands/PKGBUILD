#Contributor: matthiaskrgr <matthias · krueger _strange_curved_character_ famsike · de

pkgname=widelands
pkgver=17
pkgrel=1
pkgdesc="A realtime strategy game with emphasis on economy and transport - development version"
arch=(i686 x86_64 armv7h)
license=('GPL2')
depends=('boost-libs' 'glew' 'lua51' 'python2' 'sdl_gfx' 'sdl_image' 'sdl_mixer' 'sdl_net' 'sdl_ttf')
makedepends=('cmake' 'boost' 'mesa')
conflicts=('widelands-bzr' 'widelands-data')
url="http://wl.widelands.org"
source=(
        "https://launchpad.net/widelands/build${pkgver}/build-${pkgver}/+download/widelands-build${pkgver}-src.tar.bz2"
        "${pkgname}.desktop"
        "${pkgname}.png"
	)
md5sums=(
         'bdc9bc0aa631af1aa7fb450507611a58'
         '15820bf099fd6f16251fe70a75c534bb'
         '3dfda7e9ca76ca00dd98d745d0ceb328'
         )

prepare() {
  cd "${srcdir}/widelands-build${pkgver}-src"
  sed -i "1 i #include <unistd.h>" src/main.cc
}

build() {
  mkdir -p "${srcdir}/build"
  cd "${srcdir}/build"
#  cmake "../widelands-build${pkgver}-src" -DCMAKE_BUILD_TYPE=Release \
#    -DCMAKE_INSTALL_PREFIX=/usr \
#    -DWL_INSTALL_PREFIX=/usr \
#    -DWL_INSTALL_DATADIR=share/$pkgname \
#    -DWL_INSTALL_BINDIR=bin \
#    -DBoost_SIGNALS_LIBRARY_DEBUG=/usr/lib/libboost_signals.so \
#    -DLUA_INCLUDE_DIR=/usr/include/lua5.1

  make
}

package() {
  cd  "${srcdir}/build"
  make DESTDIR="${pkgdir}" install
  install -Dm644 "${srcdir}/${pkgname}.png" "${pkgdir}/usr/share/pixmaps/${pkgname}.png"
  install -Dm644 "${srcdir}/${pkgname}.desktop" "${pkgdir}/usr/share/applications/${pkgname}.desktop"
}
