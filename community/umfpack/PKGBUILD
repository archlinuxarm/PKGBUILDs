# $Id: PKGBUILD 2321 2009-09-16 09:21:46Z spupykin $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: iKevin <kellwood at ameritech dot net>

pkgname=umfpack
pkgver=5.4.0
pkgrel=1
pkgdesc="A multifrontal direct solver for unsymmetric linear systems"
arch=('i686' 'x86_64')
url="http://www.cise.ufl.edu/research/sparse/umfpack"
license=('LGPL')
makedepends=('lapack' 'blas')
source=(http://www.cise.ufl.edu/research/sparse/umfpack/v$pkgver/UMFPACK.tar.gz \
	http://www.cise.ufl.edu/research/sparse/UFconfig/current/UFconfig.tar.gz \
        http://www.cise.ufl.edu/research/sparse/amd/current/AMD.tar.gz \
	UFconfig.mk)
md5sums=('4455192ff4bf0fd75796d08c0ed614a6'
         '51e9e30bc8cbd750cfc4a62e8bc598ac'
         'f81fcae945de82864035b03ee20a8d2b'
         'cf6b013946072fd4ec1881e1dee25910')

build() {
  cd "$srcdir/UMFPACK"
  cp -rf "$srcdir/UFconfig/xerbla" .
  cp -L ../UFconfig.mk $startdir/src/UFconfig
  [ $CARCH == "x86_64" ] && sed -i 's#CFLAGS = -O3 -fexceptions#CFLAGS = -O3 -fexceptions -fPIC#' $srcdir/UFconfig/UFconfig.mk
  make library || return 1
  install -d "$pkgdir/usr/lib" "$pkgdir/usr/include"
  install -D -m644 Lib/libumfpack.a "$pkgdir/usr/lib/libumfpack.a"
  cp $startdir/src/UMFPACK/Include/*.h $startdir/pkg/usr/include
  install -D -m644 "$srcdir/AMD/Lib/libamd.a" "$pkgdir/usr/lib/libamd.a"
  cp $startdir/src/AMD/Include/*.h $startdir/pkg/usr/include
  install -m644 "$srcdir/UFconfig/UFconfig.h" "$pkgdir/usr/include" || return 1

  # Fix permissions
  cd $startdir/pkg/usr/include
  chmod oug+r *
  cd $startdir/pkg/usr/lib
  chmod oug+r *
}
