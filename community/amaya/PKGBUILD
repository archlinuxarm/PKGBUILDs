# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Dalius <dagis@takas.lt>

pkgname=amaya
pkgver=11.2
pkgrel=2
pkgdesc="W3C's Editor/Browser"
arch=('i686' 'x86_64')
url="http://www.w3.org/Amaya/"
license=('custom')
depends=('wxgtk' 'bash' 'libgl' 'libwww' 'raptor')
makedepends=(imake)
options=('!makeflags')
source=(http://www.w3.org/Amaya/Distribution/amaya-sources-$pkgver.tgz)
md5sums=('7fc2503abce1393e1bbd054be719ee0d')

build() {
  cd $startdir/src/Amaya$pkgver/Amaya

  mkdir GTK
  cd GTK
  export HOME=`pwd`

  if [ "$CARCH" = "x86_64" ] ; then
    [ $NOEXTRACT -eq 1 ] || cp ../../Mesa/configs/linux-x86-64 ../../Mesa/configs/current
  else
    [ $NOEXTRACT -eq 1 ] || cp ../../Mesa/configs/linux-x86 ../../Mesa/configs/current
  fi

  [ $NOEXTRACT -eq 1 ] || ../configure --prefix=/usr/share --exec=/usr/share  --datadir=/usr/share --enable-system-raptor
  make || return 1
  mkdir -p $startdir/pkg/usr/bin
  make prefix=$startdir/pkg/usr/share install || return 1

  ln -f -s ../share/Amaya/wx/bin/amaya $pkgdir/usr/bin/amaya && \
  install -D -m644 $startdir/src/Amaya$pkgver/Amaya/amaya/COPYRIGHT $startdir/pkg/usr/share/licenses/$pkgname/COPYRIGHT || return 1

  mkdir -p $pkgdir/usr/share/Amaya/lib
  cp -a $srcdir/Amaya$pkgver/Amaya/GTK/Mesa/lib/libGL.so.1* $pkgdir/usr/share/Amaya/lib/ && \
  cp -a $srcdir/Amaya$pkgver/Amaya/GTK/Mesa/lib/libGLU.so.1* $pkgdir/usr/share/Amaya/lib/ && \
  chrpath -r /usr/share/Amaya/lib $pkgdir/usr/share/Amaya/wx/bin/amaya_bin && \
  chrpath -r /usr/share/Amaya/lib $pkgdir/usr/share/Amaya/wx/bin/print
}
