# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=selinux-sysvinit
pkgver=2.86
pkgrel=1
pkgdesc="Linux System V Init"
arch=(i686 x86_64)
license=('GPL')
depends=('shadow' 'util-linux' 'coreutils' 'glibc' 'awk')
conflicts=(sysvinit)
provides=(sysvinit)
source=(ftp://ftp.cistron.nl/pub/people/miquels/sysvinit/sysvinit-$pkgver.tar.gz \
	sysvinit-init.c.diff)
md5sums=('7d5d61c026122ab791ac04c8a84db967'
         'ae3204eaf8063e13c91cbd5174760553')

build() {
  cd $startdir/src/sysvinit-$pkgver

  patch -Np0 src/init.c <../sysvinit-init.c.diff || return 1

  cp src/init.c src/init.c.backup
  sed 's/\(.*\)\(Sending processes\)\(.*\)/\1\2 started by init\3/' \
     src/init.c > tmp~
  mv tmp~ src/init.c
  mkdir -p $startdir/pkg/bin $startdir/pkg/sbin
  mkdir -p $startdir/pkg/usr/bin
  mkdir -p $startdir/pkg/usr/man/man5 $startdir/pkg/usr/man/man8
  mkdir -p $startdir/pkg/usr/man/man1 $startdir/pkg/usr/include
  make -C src || return 1
  make -C src MANDIR=/usr/man ROOT=$startdir/pkg install
}
