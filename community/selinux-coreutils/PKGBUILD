# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=selinux-coreutils
pkgver=7.1
pkgrel=1
pkgdesc="coreutils (needed for selinux)"
arch=(i686 x86_64)
license=('GPL')
url="http://www.gnu.org/software/coreutils"
depends=('bash' 'glibc' 'shadow>=4.0.4.1-3' 'selinux-pam' 'acl' 'selinux-usr-libselinux')
conflicts=(coreutils)
provides=(coreutils mktemp)
backup=('etc/pam.d/su')
options=('!makeflags' '!emptydirs' 'zipman')
source=(ftp://ftp.gnu.org/gnu/coreutils/coreutils-$pkgver.tar.gz
	su)
md5sums=('cbb2b3d1718ee1237b808e00b5c11b1e'
         'fa85e5cce5d723275b14365ba71a8aad')

build() {
  cd $startdir/src/coreutils-$pkgver

  # only needed if new autoconf 2.62 is used
#  autoreconf

  # make head and tail recognize the old syntax (eg, tail -10)
  export DEFAULT_POSIX2_VERSION=199209

  autoconf
  ./configure --prefix=/usr ac_cv_func_openat=no --enable-install-program=su --enable-pam
  make || return 1
  make DESTDIR=$startdir/pkg install
  rm -f $startdir/pkg/usr/bin/hostname $startdir/pkg/usr/share/man/man1/hostname.1 || return 1
  rm -f $startdir/pkg/usr/bin/uptime $startdir/pkg/usr/share/man/man1/uptime.1 || return 1
  rm -f $startdir/pkg/usr/bin/groups $startdir/pkg/usr/share/man/man1/groups.1 || return 1
  rm -f $startdir/pkg/usr/bin/kill $startdir/pkg/usr/share/man/man1/kill.1|| return 1
  cd $startdir/pkg/usr/bin
  mkdir -p $startdir/pkg/bin $startdir/pkg/sbin $startdir/pkg/usr/sbin
  mv su date echo false pwd stty true uname cat tr cut readlink ../../bin
  mv dd cp df du ln ls mv rm dir sync vdir chgrp chmod chown ../../bin
  mv mkdir mknod rmdir shred touch mkfifo dircolors install sleep ../../bin
  mv chroot ../sbin
  ln -sf test [
  ln -sf /bin/sleep $startdir/pkg/usr/bin/sleep
  install -D -m644 $startdir/src/su $startdir/pkg/etc/pam.d/su || return 1
  rm -f $pkgdir/usr/share/info/dir
}
