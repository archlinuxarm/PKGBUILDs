# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Contributor: phrakture <aaronmgriffin--gmail--com>

pkgname=plan9port
pkgver=20051127
pkgrel=1
pkgdesc="Plan 9 from User Space (aka plan9port) is a port of many Plan 9 \
	programs from their native Plan 9  environment to Unix-like operating \
	systems."
arch=('i686' 'x86_64')
url="http://swtch.com/plan9port/"
license=('custom')
depends=('x-server')
install=plan9.install
source=(http://swtch.com/$pkgname/$pkgname.tgz plan9.sh)
md5sums=('3ce647b0371a4bf74fa05decf17ef710'
         '9695eb15a247e23140e8a35ff52a5c20')

build()
{
  mkdir -p $startdir/pkg/etc/profile.d
  cp $startdir/src/plan9.sh $startdir/pkg/etc/profile.d/

  mkdir $startdir/pkg/opt
  mv $startdir/src/plan9 $startdir/pkg/opt

  cd $startdir/pkg/opt/plan9
  cvs update #make sure we're up to date...
  ./INSTALL

  #don't need these in the package
  rm install.log
  rm -r src/
  find . -name CVS -exec rm -rf {} \;

  borkedfiles=`grep -r $startdir/pkg/opt/plan9 * | grep -v Binary | cut -d\: -f1`
  for f in $borkedfiles; do
    echo "fixing hardcoded paths in $f"
    sed -i "s@$startdir/pkg/opt/plan9@/opt/plan9@" $f
  done
}
