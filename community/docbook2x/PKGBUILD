# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Alessio 'mOLOk' Bolognino <themolok@gmail.com>

pkgname=docbook2x
pkgver=0.8.8
pkgrel=7
pkgdesc="A software package that converts DocBook documents into the traditional Unix man page format and the GNU Texinfo format."
arch=('i686' 'x86_64')
url="http://docbook2x.sourceforge.net"
license=("MIT")
depends=('glibc' 'perl-sgmls' 'perlxml' 'perl-xml-sax' 'libxslt')
makedepends=('texinfo')
install=docbook2x.install
source=(http://downloads.sourceforge.net/$pkgname/docbook2X-$pkgver.tar.gz)
md5sums=('b9b76a6af198c4f44574cfd17a322f01')

build()  {
  cd $startdir/src/docbook2X-$pkgver

  install -D -m0644 COPYING $pkgdir/usr/share/licenses/$pkgname/license || return 1

  ./configure  --prefix=/usr/
  make || return 1
  make DESTDIR=$startdir/pkg install || return 1

  # some fixes
  cd $startdir/pkg/usr/bin && \
  ln -s docbook2man docbook2x-man && \
  ln -s docbook2texi docbook2x-texi && \
  sed -i 's|http://docbook2x.sf.net/latest|/usr/share/docbook2X|g' db2x_xsltproc && \
  sed -i 's|${prefix}|/usr|g' db2x_manxml && \
  sed -i 's|${prefix}|/usr|g' db2x_texixml && \
  sed -i 's|${prefix}|/usr|g' db2x_xsltproc && \
  sed -i 's|${prefix}|/usr|g' docbook2man && \
  sed -i 's|${prefix}|/usr|g' docbook2texi && \
  sed -i 's|${prefix}|/usr|g' sgml2xml-isoent && \
  sed -i 's|${prefix}|/usr|g' utf8trans || return 1

  rm -f $pkgdir/usr/share/info/dir && \
  gzip $pkgdir/usr/share/info/*.info || return 1
}
