# $Id: PKGBUILD 2191 2009-09-10 15:02:52Z spupykin $
# Contributor: robb_force <robb_force@holybuffalo.net>
# Maintainer: JJDaNiMoTh <jjdanimoth@gmail.com>

pkgname=sdlmame
pkgver=0.134
pkgrel=1
pkgdesc="A port of the popular Multiple Arcade Machine Emulator using SDL with OpenGL support."
url="http://rbelmont.mameworld.info/?page_id=163"
license=('custom:MAME License')
arch=('i686' 'x86_64')
depends=('sdl>=1.2.11' 'libxinerama' 'gconf')
makedepends=('unzip' 'nasm' 'mesa')
DLAGENTS=('http::/usr/bin/wget -U "Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.2) Gecko/20090804 Shiretoko/3.5.2" -c -t 3 --waitretry=3')
options=('!makeflags' 'force')
install=sdlmame.install
source=(http://rbelmont.mameworld.info/${pkgname}${pkgver%.*}${pkgver#*.}.zip \
	sdlmame.sh \
	extras.tar.gz)
md5sums=('f22ed63a64f410c0bc05bcc4d9b6f7c7'
         '3119ccfa1e970eba4467df31208adaf0'
         '420b61240bf5ae11615ba7c6100ee00d')

build() {
  cd ${startdir}/src/${pkgname}${pkgver%.*}${pkgver#*.}

  sed -i 's/-Werror//' makefile || return 1

  # Modify the make options based on the user's architecture
  if [ "$CARCH" == "x86_64" ]; then
    echo "Compiling for AMD64..."
    make AMD64=1 PTR64=1 || return 1
  elif [ "$CARCH" == "i686" ]; then
    make I686=1 || return 1
  else
    echo "Compiling for i386..."
    make PM=1 || return 1
  fi

  # Install the sdlmame script
  install -Dm755 ${startdir}/src/${pkgname}.sh ${startdir}/pkg/usr/bin/${pkgname} || return 1

  # Install the applications and the UI font in /usr/share
  install -Dm755 mame* ${startdir}/pkg/usr/share/${pkgname}/${pkgname} && \
  install -m755 chdman ${startdir}/pkg/usr/share/${pkgname}/chdman && \
  install -m755 jedutil ${startdir}/pkg/usr/share/${pkgname}/jedutil && \
#  install -m755 makemeta ${startdir}/pkg/usr/share/${pkgname}/makemeta && \
  install -m755 regrep ${startdir}/pkg/usr/share/${pkgname}/regrep && \
  install -m755 romcmp ${startdir}/pkg/usr/share/${pkgname}/romcmp && \
  install -m755 runtest ${startdir}/pkg/usr/share/${pkgname}/runtest && \
  install -m755 testkeys ${startdir}/pkg/usr/share/${pkgname}/testkeys && \
  install -m755 src2html ${startdir}/pkg/usr/share/${pkgname}/src2html && \
  install -m755 srcclean ${startdir}/pkg/usr/share/${pkgname}/srcclean && \
  install -m755 ldverify ${startdir}/pkg/usr/share/${pkgname}/ldverify && \
  install -m644 ui.bdf ${startdir}/pkg/usr/share/${pkgname}/ui.bdf || return 1

  # Install the extra bits
  install -d ${startdir}/pkg/usr/share/${pkgname}/{artwork,ctrlr,keymaps} && \
  install -m644 ${startdir}/src/artwork/* ${startdir}/pkg/usr/share/${pkgname}/artwork/ && \
  install -m644 ${startdir}/src/ctrlr/* ${startdir}/pkg/usr/share/${pkgname}/ctrlr/ && \
  install -m644 keymaps/* ${startdir}/pkg/usr/share/${pkgname}/keymaps/ || return 1

  # Include the license
  install -Dm644 docs/license.txt $startdir/pkg/usr/share/licenses/${pkgname}/license.txt
}
