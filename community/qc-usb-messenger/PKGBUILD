# $Id: PKGBUILD 82 2009-07-17 19:56:55Z aaron $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Maintainer: Luiz Ribeiro <luizribeiro@gmail.com>

_kernver=`pacman -Q kernel26 | cut -d . -f 3 | cut -f 1 -d -`
pkgname=qc-usb-messenger
pkgver=1.8
pkgrel=6
pkgdesc="QuickCam Messenger & Communicate driver for Linux"
arch=('i686' 'x86_64')
url="http://home.mag.cx/messenger/"
license=('GPL')
depends=("kernel26>=2.6.${_kernver}" "kernel26<2.6.`expr ${_kernver} + 1`")
conflicts=('qc-usb')
install=$pkgname.install
source=(http://home.mag.cx/messenger/source/$pkgname-$pkgver.tar.gz \
	http://files.luizribeiro.org/$pkgname-$pkgver-kcompat-2.6.28.diff \
	http://arch.pp.ru/~sergej/dl/qc-usb-messenger-1.8-kcompat-2.6.30.diff.gz)
md5sums=('58dc5652a0c91e6cc2adc682ca848964'
         '40e31a18cb63f34acfaed1f8c3812490'
         '7b7295d1115ebb6e3da4e99fed43623d')

build() {
  cd $startdir/src/$pkgname-$pkgver

  patch -p1 < $startdir/src/$pkgname-$pkgver-kcompat-2.6.28.diff
  patch -p1 < $startdir/src/$pkgname-$pkgver-kcompat-2.6.30.diff

  make all || return 1
  _kernelver=`uname -r`
  make install PREFIX=$startdir/pkg/usr MODULE_DIR=$startdir/pkg/lib/modules/$_kernelver LINUX_DIR=/lib/modules/$_kernelver/build
}
