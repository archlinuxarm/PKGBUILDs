# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

# ALARM: Kevin Mihelich <kevin@archlinuxarm.org>
#  - patches to fix issues with how we use the tools
# ALARM: Maxim Baz <archlinux at maximbaz dot com>
#  - add ARM-specific helpers to build in clean chroot with recommended flags

pkgname=devtools-alarm
_pkgname=devtools
pkgver=20220621
pkgrel=2
pkgdesc='Tools for Arch Linux ARM package maintainers'
arch=('any')
license=('GPL')
url='https://gitlab.archlinux.org/archlinux/devtools'
conflicts=('devtools')
provides=('devtools')
depends=('bash' 'openssh' 'subversion' 'rsync' 'arch-install-scripts'
         'git' 'bzr' 'mercurial' 'diffutils' 'util-linux' 'awk')
makedepends=('asciidoc')
optdepends=('btrfs-progs: btrfs support')
source=(${url}/uploads/8217baae0afcdb540bde9f5b030f05a9/devtools-${pkgver}.tar.gz
        ${url}/uploads/8570458d06b07d5a3ff8d30a1fc392d4/devtools-${pkgver}.tar.gz.sig
        '0001-makechrootpkg-cache-dir.patch'
        '0002-arch-nspawn-keep-mirrorlist.patch'
        '0003-makechrootpkg-distcc.patch'
        '0004-arch-nspawn-arm-fix.patch'
        '0005-makechrootpkg-no-default-logging.patch'
        '0006-archbuild-no-setarch.patch'
        '0007-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACKAGER.patch'
        '0008-makechrootpkg-gotmpdir.patch'
        '0009-Makefile-arm-helpers.patch'
        '0010-makepkg-aarch64-conf.patch' 
        '0011-makepkg-armv7h-conf.patch')
validpgpkeys=(
  '4AA4767BBC9C4B1D18AE28B77F2D434B9741E8AC' # Pierre Schmitz <pierre@archlinux.org>
  '86CFFCA918CF3AF47147588051E8B148A9999C34' # Evangelos Foutras <foutrelis@archlinux.org>
  '8FC15A064950A99DD1BD14DD39E4B877E62EB915' # Sven-Hendrik Haase <svenstaro@archlinux.org>
  'A2FF3A36AAA56654109064AB19802F8B0D70FC30' # Jan Alexander Steffens (heftig) <heftig@archlinux.org>
  'B81B051F2D7FC867AAFF35A58DBD63B82072D77A' # SÃ©bastien Luttringer <seblu@archlinux.org>
  '6645B0A8C7005E78DB1D7864F99FFE0FEAE999BD' # Allan McRae (Developer) <allan@archlinux.org>
  'E240B57E2C4630BA768E2F26FC1B547C8D8172C8' # Levente Polyak <anthraxx@archlinux.org>
)
sha256sums=('0938d41b4bc469e62d86d2a287612a090640f6eebde92137b8bd7727b89e95dd'
            'SKIP'
            '618bda0dad5337f8e1500832a5f255300802e94ada7711907dc47f2569e9f519'
            'b0e43fb242096127aba846d9f597bb31c34a5de636e4bd473a2fdf63d9a89976'
            'd6ef2ff23accb15b554cf54d75ca5a55ff67400c0852d2646a3bd5533d1ed70d'
            '9d9e6949882d89dfb1cc8dc833dbb1f4bb4a0d1be50439a3ae27e78820df3763'
            '1d6f17cc9c77690bdd007e276da52a6acf54b52dbe081ce6c6767a3fa1b5b113'
            '2f68d22a0c04fe6a47266a9e2b68b90b092be6ab5888686609fd85b19ed8c5b3'
            '3b6d1b20d5145d13c8d8b8fd4a6555034579067dcb768ea574e29bfb7101fb09'
            '1162044b55ebf6cbec81da94dd1d85e48657311f03e322f3a17dc22e060b54a1'
            '5b2fac46c1a0834573f35a6ba3d10246c7fd5778b1cb8ce1f631afbc178e7501'
            'bdc10f991544b824577199d04c8f9457efd99c1543e6f00134f11cddea198d9b'
            '8cb082ca41abd01a5c8ede7dff800ae90e3b1f8704e83efa431b8c43711a3cc9')
b2sums=('007f62b6cb3f06904fcafec4869a43136643bd364a7f0f314c792c08fbdafafaf8a268f8a372f78402deaa1f87bfc3f2fc7099f78742c6776d4ac49fe4884d58'
        'SKIP'
        '1d1a9c5ea3279dc0bae47265f5068b6fae2de63c6f81cba0a713b36b84ddb60f5e982f5e3acc21dd2316fbf9b756036091c51545f1fa1a623628e72bbe2b717d'
        'ed5c5c92caf67e13ba06dae6c73d775786eaf640fbc06cb70faf0d0f088f9c092fda2be76d767b20d96a10c670818d3bf7ebbc96467418234add7b88f308dc34'
        '4406f49a909b7101e2950ae6ee0484f6e71da41396d2a6884b0df996d06fc94026624cc2e87f237b5ffb017414f6c7cd34ef881234654763c4e194c9a1460db2'
        '4d8c095d07218f1f7d252e1a2cb0f01cf4c2fd856a9dfaa06006e51a32107b53e3ec0ce19606ed5f2c9888863b08330dd4ce2f95d0df8c585edcffe85dd4a094'
        '8a672b6debaac19baf2189acbb72b027860bf6d16306feb8d93f48c5ef32f5d073a618a04c65ed645f47d46332b0cead282b63950b2dab0efcab23b38cc61dc8'
        'd796e4c6c8522889d803fe6ee6f52cec548e34db28bb2aeb7a62d7d3cb5e357692d83292d6b51045bc799e3f1ce985583b905b0dd9d2b22cfbdd430e6a60f5c8'
        '9003b89871dcb20f36991a28a3095762191ed9101283504a3a986e38d1b9f207a5db6d7500f047ee40dea6fe17a21a56a94aba5816ad686490d7534cdf77b715'
        '66b23af5326e0031657f2499ae004cf922b71623798f885d7c777fa1cf44172db2ae05d7128bb932df3f3f2a7c47b418d428687c9f149c2d0b487ec6bd68571e'
        'cd540a1e5bc397174c21b1d6308dca0822eafb1cf4c11dd8de1676388f7aa88e8722aa2b91f43ac958c5674dda1f8bf5517373649d40731b3c03bdcefe9208b4'
        '97b65915cb2e9dc04378a1788d5b19d9aad7afc8632d739265a48935ec676684835cf02e16ee7ace3a31316fc4e49abe956de7cbe804c6afc24bb75c831a7577'
        '5345ba473a52154cb39e2a6d3f6d1a7ca19bf48884d806168a9c265764ad42ff330d7a32090a888d30029a9ea6682d52f6ccbb490bd015bb1bc28440e62095bf')

prepare() {
  cd "${_pkgname}-${pkgver}"
  patch -p1 -i ../0001-makechrootpkg-cache-dir.patch
  patch -p1 -i ../0002-arch-nspawn-keep-mirrorlist.patch
  patch -p1 -i ../0003-makechrootpkg-distcc.patch
  patch -p1 -i ../0004-arch-nspawn-arm-fix.patch
  patch -p1 -i ../0005-makechrootpkg-no-default-logging.patch
  patch -p1 -i ../0006-archbuild-no-setarch.patch
  patch -p1 -i ../0007-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACKAGER.patch
  patch -p1 -i ../0008-makechrootpkg-gotmpdir.patch
  patch -p1 -i ../0009-Makefile-arm-helpers.patch
  patch -p1 -i ../0010-makepkg-aarch64-conf.patch -o makepkg-aarch64.conf
  patch -p1 -i ../0011-makepkg-armv7h-conf.patch -o makepkg-armv7h.conf
}

build() {
  cd ${_pkgname}-${pkgver}
  make BUILDTOOLVER="${pkgver}-${pkgrel}-${arch}" PREFIX=/usr
}

package() {
  cd ${_pkgname}-${pkgver}
  make PREFIX=/usr DESTDIR="${pkgdir}" install
}

# vim: ts=2 sw=2 et:
