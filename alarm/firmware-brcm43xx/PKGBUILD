# Maintainer: Dave H <pepedog at archlinuxarm dot org>

buildarch=4

pkgname=firmware-brcm43xx
pkgdesc="bluetooth firmware and firware loading utility for the bcm43xx bluetooth"
pkgver=1.1
pkgrel=4
arch=('armv7h')
url="https://github.com/OpenBricks/openbricks/tree/master/packages/brcm-patchram-plus"
license=('apache' 'custom')
makedepends=('')
depends=('bluez-utils')
backup=('etc/conf.d/bcm43xx')
source=('https://raw.githubusercontent.com/OpenBricks/openbricks/master/packages/firmware/firmware-wifi-brcm80211/config/bcm4329_nvram.txt'
        'https://raw.githubusercontent.com/OpenBricks/openbricks/master/packages/firmware/firmware-wifi-brcm80211/config/bcm4330_nvram.txt'
        'https://github.com/OpenBricks/openbricks/raw/master/packages/net/brcm-patchram-plus/sources/bcm4329.hcd'
        'https://github.com/OpenBricks/openbricks/raw/master/packages/net/brcm-patchram-plus/sources/bcm4330.hcd'
        'https://raw.githubusercontent.com/OpenBricks/openbricks/master/packages/net/brcm-patchram-plus/sources/brcm_patchram_plus.c'
        'brcm43xx-firmware-update'
        'brcm43xx-firmware.service'
        'brcm43xx.service'
        'bcm43xx')
sha256sums=(
	'340439ccce156fd9bf4c2b29c98a0109ff5df0ee8b0fc00197b6845c68a8e7fa'
	'af459bccd3476c5ae487ff1137462591ccbe9b9bef73baf0a4bd9ddef527cef0'
	'7fbab01012c909b9b2de0fda3a76c43fa1c5c150e08642d7d1dbaf4d5ebf887c'
	'f790c0c981f003a684b2aaea0eb7e475ff33c3b7bc204678fee5efbbe21148a0'
	'fe91e08aadf195686cc6bfb3d81969b33bfc703d0a513455877d7bf97dad3730'
	'd43a60ec03a8dfff5caea6fb33b247001bb36881f9bf8554b82a27167b5cae63'
	'f037655701cb1b0a01b4a17a580e1b207c7eea793850df1a3a66844097b87c8c'
	'a85369c064d88cdbd1d7ac700fdb3675479d67eb1bd294b56324c9ede40eff92'
	'd2e2f20a6b6adef36086d8d76a80e83453af482edaa607e530034b28e8ae31c9')

build() {
  cd "${srcdir}/"
  gcc brcm_patchram_plus.c -o brcm_patchram_plus
}


package() {
  cd "${srcdir}/"
  mkdir -p ${pkgdir}/usr/lib/firmware/brcm
  mkdir -p ${pkgdir}/usr/bin
  mkdir -p ${pkgdir}/etc/conf.d
  mkdir -p ${pkgdir}/usr/lib/systemd/scripts
  install -D -m0644 bcm4329_nvram.txt "${pkgdir}/usr/lib/firmware/brcm/brcmfmac4329-sdio.txt"
  install -D -m0644 bcm4330_nvram.txt "${pkgdir}/usr/lib/firmware/brcm/brcmfmac4330-sdio.txt"
  install -D -m0644 bcm4329.hcd "${pkgdir}/usr/lib/firmware/brcm/bcm4329.hcd"
  install -D -m0644 bcm4330.hcd "${pkgdir}/usr/lib/firmware/brcm/bcm4330.hcd"
  install -D -m0755 brcm_patchram_plus "${pkgdir}/usr/bin/brcm_patchram_plus" 
  install -D -m0644 bcm43xx "${pkgdir}/etc/conf.d/bcm43xx"
  install -D -m0644 brcm43xx.service "${pkgdir}/usr/lib/systemd/system/brcm43xx.service"
  install -D -m0644 brcm43xx-firmware.service "${pkgdir}/usr/lib/systemd/system/brcm43xx-firmware.service"
  install -D -m0755 brcm43xx-firmware-update "${pkgdir}/usr/lib/systemd/scripts/brcm43xx-firmware-update"
}

