# After modifying, run ./mkscr

part uuid ${devtype} ${devnum}:${bootpart} uuid
setenv bootargs console=ttyS2,1500000 root=PARTUUID=${uuid} rw rootwait
setenv fdtfile rockchip/rk3399-rock-pi-4.dtb

if load ${devtype} ${devnum}:${bootpart} ${kernel_addr_r} /boot/Image; then
  if load ${devtype} ${devnum}:${bootpart} ${fdt_addr_r} /boot/dtbs/${fdtfile}; then
    fdt addr ${fdt_addr_r}
    # Try to load the uboot wrapped initramfs first
    if load ${devtype} ${devnum}:${bootpart} ${ramdisk_addr_r} /boot/initramfs-linux.img.uboot; then
      booti ${kernel_addr_r} ${ramdisk_addr_r} ${fdt_addr_r}
    fi;
    # No wrapped initramfs found, then boot kernel directly. ArchlinuxARM
    # kernel has EXT4 and XFS compiled in, so it should be able to boot rootfs
    # without the help of initramfs, as long as user is not using advanced
    # storage stack like LVM or RAID.
    booti ${kernel_addr_r} - ${fdt_addr_r};
  fi;
fi
