# $Id: PKGBUILD 116498 2011-03-24 09:12:50Z jgc $
# Maintainer: Jan de Groot <jgc@archlinux.org>
# Contributor: mgushee
# Contributor: macau <tema.prokopenko@gmail.com> // add gcc4.6 patch and arm-specific optimization fix

plugrel=1

pkgname=djvulibre
pkgver=3.5.24
pkgrel=1
pkgdesc="Suite to create, manipulate and view DjVu ('déjà vu') documents"
arch=("i686" "x86_64")
license=('GPL')
url="http://djvu.sourceforge.net/"
depends=('gcc-libs' 'libtiff' 'bash' 'hicolor-icon-theme')
makedepends=('pkg-config')
provides=("libdjvu=${pkgver}")
replaces=('libdjvu')
conflicts=('libdjvu')
optdepends=('djview4: Viewer application')
options=('!libtool')
install=djvulibre.install
source=(http://downloads.sourceforge.net/djvu/${pkgname}-${pkgver}.tar.gz gcc46fix.patch) 
md5sums=('af83d27af5083198432a178d22b259c5'
         '9b8e48db7924fa517f43f93cead93a98')
build() {
  cd "${srcdir}/${pkgname}-${pkgver}"

sed 's/AC_CXX_OPTIMIZE/OPTS=;AC_SUBST(OPTS)/' -i configure.ac || die
patch -Np0 -i $srcdir/gcc46fix.patch

  ./configure --prefix=/usr --disable-desktopfiles
  make
  make DESTDIR="${pkgdir}" install

  #Install icons for mime-types.
  install -m755 -d ${pkgdir}/usr/share/icons/hicolor/{22x22,32x32,48x48,64x64}/mimetypes
  for sz in 22 32 48 64; do
    install -m644 desktopfiles/prebuilt-hi${sz}-djvu.png "${pkgdir}/usr/share/icons/hicolor/${sz}x${sz}/mimetypes/image-vnd.djvu.mime.png"
  done
}


