# Maintainer: Aaron Griffin <aaron@archlinux.org>
# Contributor: Aurelien Foret <orelien@chez.com>
# Contributor: Evangelos Foutras <foutrelis@gmail.com>

pkgname=bash-completion
pkgver=1.0
pkgrel=3
pkgdesc="Programmable completion for the bash shell"
arch=(any)
url="http://bash-completion.alioth.debian.org/"
license=('GPL')
depends=('bash')
source=(http://bash-completion.alioth.debian.org/files/$pkgname-$pkgver.tar.gz
        fix-_filedir-on-bash-4.patch)
md5sums=('cd1c5648272917fbe0eef4ba30bb93f4'
         '1c707436109fb4c80ef7abeefc7dd1b0')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  # fixes for archlinux
  sed -i 's#/sbin/lsmod#/bin/lsmod#' bash_completion || return 1

  patch -up1 < $srcdir/fix-_filedir-on-bash-4.patch

  ./configure --prefix=/usr --sysconfdir=/etc
  make || return 1
  make DESTDIR="$pkgdir" install

  # apache2ctl doesn't work, even when renamed to apachectl (and sed'd)
  rm "$pkgdir/etc/bash_completion.d/apache2ctl"
}
