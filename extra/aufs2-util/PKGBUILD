# Maintainer: Manuel Rotter <rotter.manuel@gmail.com> 

pkgname=aufs2-util-kernel26-openmoko
pkgver=20090904
pkgrel=1
pkgdesc="Another Unionfs Implementation"
arch=('arm')
url="http://aufs.sourceforge.net/"
license=('GPL2')
depends=('glibc' 'aufs2-standalone-kernel26-openmoko')
makedepends=('git')

_gitroot="http://git.c3sl.ufpr.br/pub/scm/aufs/aufs2-util.git"
_gitname="aufs2-util.git"

build() {
  ### ATTENTION: you have to download kernel26-openmoko PKGBUILD
  ### and build it at /var/abs/core/kernel26-openmoko
  ### in order to build this package!

  cd $srcdir
  # get a header file that is needed and save to kernel source tree
  wget -P /var/abs/core/kernel26-openmoko/src/linux-2.6/include/linux \
    http://naeg.archmobile.org/stuff/aufs_type.h  
 ## Git checkout
  git clone ${_gitroot}  || return 1
  msg "Checkout completed"

  msg "Beginn Build..."
  cd $startdir/src/aufs2-util

    # Fix TMPFS_MAGIC error
  sed 's|-le 26|-le 27|g' -i Makefile || return 1

  # build
  make KDIR=/var/abs/core/kernel26-openmoko/src/linux-2.6/ || return 1

  # install
  install -D -m755 aubrsync $startdir/pkg/usr/bin/aubrsync || return 1
  install -D -m755 auchk $startdir/pkg/usr/bin/auchk || return 1
  install -D -m755 auplink $startdir/pkg/usr/bin/auplink || return 1
  install -D -m755 mount.aufs $startdir/pkg/sbin/mount.aufs || return 1
  install -D -m755 umount.aufs $startdir/pkg/sbin/umount.aufs || return 1
}
